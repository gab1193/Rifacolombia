<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Camerino VIP ğŸ­ | Rifa Colombia 2026</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#0f172a" />

  <style>
    .glass {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
    }
    .fade-in { animation: fadeIn .35s ease-out both; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(6px);} to {opacity:1; transform: translateY(0);} }
    .soft-glow { box-shadow: 0 0 0 1px rgba(255,255,255,.06), 0 20px 80px rgba(0,0,0,.45); }
  </style>
</head>

<body class="min-h-screen bg-slate-950 text-slate-100">
  <!-- Header -->
  <header class="max-w-4xl mx-auto px-4 pt-8 pb-4">
    <div class="flex items-center justify-between">
      <a href="/" class="text-slate-200 hover:text-white text-sm">â† Volver a la rifa</a>

      <div class="flex items-center gap-2">
        <span class="hidden sm:inline text-xs text-slate-400">Acceso exclusivo</span>
        <span class="inline-flex items-center gap-2 rounded-full bg-emerald-500/15 border border-emerald-500/25 px-3 py-1 text-xs text-emerald-200">
          <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
          VIP
        </span>
      </div>
    </div>

    <h1 class="mt-5 text-3xl md:text-4xl font-extrabold tracking-tight">
      ğŸ­ Camerino
      <span class="block text-base font-normal text-slate-300 mt-2">
        Accede con tu boleto y los Ãºltimos 4 dÃ­gitos de tu WhatsApp.
      </span>
    </h1>
  </header>

  <main class="max-w-4xl mx-auto px-4 pb-10">
    <!-- Acceso -->
    <section id="accessCard" class="glass soft-glow rounded-2xl p-5 md:p-6">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-slate-300 mb-1">ğŸŸï¸ NÃºmero de boleto</label>
          <input id="ticketInput" inputmode="numeric" placeholder="Ej: 17"
            class="w-full rounded-xl bg-slate-900/60 border border-slate-700 px-4 py-3 outline-none focus:border-slate-400"
          />
        </div>

        <div>
          <label class="block text-sm text-slate-300 mb-1">ğŸ“± Ãšltimos 4 dÃ­gitos de tu WhatsApp</label>
          <input id="last4Input" inputmode="numeric" maxlength="4" placeholder="Ej: 5659"
            class="w-full rounded-xl bg-slate-900/60 border border-slate-700 px-4 py-3 outline-none focus:border-slate-400"
          />
        </div>
      </div>

      <div class="mt-4 flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
        <button id="btnEnter"
          class="rounded-xl bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-semibold px-5 py-3 transition">
          Entrar al Camerino
        </button>

        <a id="waHelp" href="#" class="text-sm text-slate-300 hover:text-white underline underline-offset-4">
          Â¿Necesitas ayuda por WhatsApp?
        </a>
      </div>

      <div id="statusBox" class="mt-4 hidden rounded-xl p-4 text-sm"></div>

      <p class="mt-3 text-xs text-slate-400 leading-relaxed">
        Este acceso se valida con el registro del boleto. Si tu compra fue reciente, espera un momento e intenta de nuevo.
      </p>
    </section>

    <!-- VIP -->
    <section id="vipArea" class="hidden mt-6 space-y-6 fade-in">
      <!-- Bienvenida -->
      <div class="glass soft-glow rounded-2xl p-5 md:p-6">
        <p class="text-sm text-slate-300">Acceso verificado âœ…</p>
        <h2 class="text-2xl md:text-3xl font-bold mt-1">
          Bienvenido, <span id="vipName" class="text-white">Participante</span>
        </h2>
        <p class="mt-2 text-slate-300">
          ğŸŸï¸ Boleto: <span id="vipTicket" class="font-semibold text-white">#</span>
          <span id="vipMask" class="ml-2 text-xs text-slate-400"></span>
        </p>
      </div>

      <!-- CanciÃ³n -->
      <div class="glass soft-glow rounded-2xl p-5 md:p-6">
        <div class="flex items-center justify-between gap-3">
          <h3 class="text-xl font-bold">ğŸ§ Depto â€” InÃ©dita (solo Camerino)</h3>
          <span class="text-xs text-slate-400">Acceso VIP</span>
        </div>

        <p class="mt-2 text-slate-300 leading-relaxed" id="songIntro">
          Gracias por estar dentro. AquÃ­ tienes un adelanto que no estÃ¡ en plataformas: â€œDeptoâ€.
        </p>

        <div class="mt-4 rounded-2xl bg-slate-900/60 border border-slate-800 p-4">
          <p class="text-xs text-slate-400 mb-2">Dale play cuando estÃ©s listo. Tip: Si estas usando datos espera a tener una conexiÃ³n a internet.</p>
          <audio id="audioPlayer" controls preload="none" class="w-full"></audio>
        </div>

        <!-- Historia -->
        <div class="mt-5 rounded-2xl bg-slate-900/40 border border-slate-800 p-4">
          <h4 class="font-semibold text-white">La historia detrÃ¡s de â€œDeptoâ€</h4>
          <p class="mt-2 text-sm text-slate-300 leading-relaxed">
            â€œDeptoâ€ naciÃ³ hace poco mÃ¡s de dos aÃ±os, fue la primera canciÃ³n que termine despues de mudarme a Hermosillo.
            Es una canciÃ³n que me gusta mucho por el estilo y la creacion de la misma y ahora es de ustedes. Espero les guste:).
          </p>
          <p class="mt-2 text-sm text-slate-300 leading-relaxed">
            La escribÃ­ 100% yo y la produjimos entre Gatu y yo. La guardÃ© porque no era para cualquiera:
            es de esas rolas que se escuchan cuando ya entiendes el mood, cuando ya viviste algo parecido.
            Si estÃ¡s aquÃ­, ya eres parte del cÃ­rculo.
          </p>
          <p class="mt-2 text-xs text-slate-400">
            Autor: Alan Aragon (Gabe) â€¢ ProducciÃ³n: Alan Aragon (Gabe) &amp; Gatu â€¢ TÃ­tulo: â€œDeptoâ€
          </p>
        </div>
      </div>

      <!-- Comunidad -->
      <div class="glass soft-glow rounded-2xl p-5 md:p-6">
        <h3 class="text-xl font-bold">ğŸ«¶ Comunidad VIP</h3>
        <p class="mt-2 text-slate-300">
          MÃ¡s mÃ¡s mÃ¡s... cada dÃ­a sumamos mÃ¡s!!!
        </p>

        <div class="mt-4 grid md:grid-cols-2 gap-4">
          <div class="rounded-2xl bg-slate-900/60 border border-slate-800 p-4">
            <p class="text-sm text-slate-300">ğŸ“Œ AquÃ­ dentro</p>
            <ul class="mt-2 text-sm text-slate-200 list-disc list-inside space-y-1">
              <li>Contenido exclusivo</li>
              <li>Backstage y actualizaciones</li>
              <li>DinÃ¡micas especiales</li>
            </ul>
          </div>

          <div class="rounded-2xl bg-slate-900/60 border border-slate-800 p-4">
            <p class="text-sm text-slate-300">ğŸš€ Lo que viene</p>
            <ul class="mt-2 text-sm text-slate-200 list-disc list-inside space-y-1">
              <li>Menciones VIP</li>
              <li>DinÃ¡micas y extras</li>
              <li>Sorpresas para participantes</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Compartir -->
      <div class="glass soft-glow rounded-2xl p-5 md:p-6">
        <h3 class="text-xl font-bold">ğŸ“£ Comparte la rifa</h3>
        <p class="mt-2 text-slate-300">
          Entre mÃ¡s rÃ¡pido se llene, mÃ¡s rÃ¡pido se juegaâ¤ï¸
        </p>
        <div class="mt-4 flex flex-col md:flex-row gap-3">
          <button id="btnCopy"
            class="rounded-xl bg-slate-100 hover:bg-white text-slate-950 font-semibold px-5 py-3 transition">
            Copiar link
          </button>
          <a id="btnShareWa" href="#"
            class="rounded-xl bg-green-500 hover:bg-green-400 text-slate-950 font-semibold px-5 py-3 transition text-center">
            Compartir por WhatsApp
          </a>
        </div>

        <div id="shareHint" class="mt-3 text-xs text-slate-400"></div>
      </div>
    </section>
  </main>

  <footer class="max-w-4xl mx-auto px-4 pb-10 text-center text-xs text-slate-500">
    Â© Rifa Colombia 2026 â€” Camerino VIP
  </footer>

  <script>
    // ====== CONFIG CLIENTE ======
    const AUDIO_URL = "/Depto.mp3";
    const SUPPORT_WA_NUMBER = "52XXXXXXXXXX"; // Ej: "526311234567" (si no lo pones, se oculta el link)

    // ====== Helpers ======
    const $ = (id) => document.getElementById(id);

    function onlyDigits(value) {
      return (value || "").toString().replace(/\D/g, "");
    }

    function showStatus(type, message) {
      const box = $("statusBox");
      box.classList.remove("hidden");
      box.className = "mt-4 rounded-xl p-4 text-sm";

      if (type === "ok") {
        box.classList.add("bg-emerald-500/15", "border", "border-emerald-500/30", "text-emerald-200");
      } else if (type === "warn") {
        box.classList.add("bg-amber-500/15", "border", "border-amber-500/30", "text-amber-200");
      } else {
        box.classList.add("bg-red-500/15", "border", "border-red-500/30", "text-red-200");
      }
      box.innerHTML = message;
    }

    function hideStatus() {
      const box = $("statusBox");
      box.classList.add("hidden");
      box.innerHTML = "";
    }

    function hideAccessForm() {
      $("accessCard").classList.add("hidden");
    }

    // ====== Cargar GAS_URL desde Vercel env via /api/config ======
    async function getGasUrl() {
      try {
        const res = await fetch("/api/config", { cache: "no-store" });
        if (!res.ok) throw new Error("config not ok");
        const json = await res.json();
        const gas = (json?.gas_url || "").trim();
        return gas;
      } catch {
        return "";
      }
    }

    // ====== ValidaciÃ³n contra Apps Script ======
    async function verifyCamerino(gasUrl, numero, last4) {
      const url = new URL(gasUrl);
      url.searchParams.set("action", "verify_camerino");
      url.searchParams.set("numero", numero);
      url.searchParams.set("last4", last4);
      url.searchParams.set("_", Date.now().toString()); // anti-cache

      const res = await fetch(url.toString(), { method: "GET" });
      if (!res.ok) throw new Error("No se pudo verificar en este momento.");
      return await res.json();
    }

    // ====== Prefill por URL opcional ======
    const params = new URLSearchParams(window.location.search);
    const preTicket = params.get("ticket");
    const preLast4 = params.get("last4");
    if (preTicket) $("ticketInput").value = preTicket;
    if (preLast4) $("last4Input").value = preLast4;

    // ====== WhatsApp soporte ======
    const waHelp = $("waHelp");
    if (!SUPPORT_WA_NUMBER || SUPPORT_WA_NUMBER.includes("X")) {
      waHelp.classList.add("hidden");
    } else {
      waHelp.addEventListener("click", (e) => {
        e.preventDefault();
        const t = onlyDigits($("ticketInput").value);
        const l4 = onlyDigits($("last4Input").value).slice(-4);
        const msg = encodeURIComponent(
          `Hola, necesito ayuda con el acceso al Camerino.\nBoleto: ${t || "(no lo recuerdo)"}\nWhatsApp termina en: ${l4 || "(no lo recuerdo)"}`
        );
        window.open(`https://wa.me/${SUPPORT_WA_NUMBER}?text=${msg}`, "_blank");
      });
    }

    // ====== Share ======
    $("btnCopy")?.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText("https://rifacolombia.online");
        $("shareHint").textContent = "âœ… Link copiado.";
        setTimeout(() => $("shareHint").textContent = "", 2200);
      } catch {
        $("shareHint").textContent = "Copia manualmente: https://rifacolombia.online";
      }
    });

    $("btnShareWa")?.addEventListener("click", (e) => {
      e.preventDefault();
      const text = encodeURIComponent("Te paso la rifa ğŸ‘‡\nhttps://rifacolombia.online");
      window.open(`https://wa.me/?text=${text}`, "_blank");
    });

    // ====== Enter ======
    $("btnEnter").addEventListener("click", async () => {
      hideStatus();

      const ticket = onlyDigits($("ticketInput").value);
      const last4 = onlyDigits($("last4Input").value).slice(-4);

      if (!ticket) {
        showStatus("warn", "âš ï¸ Escribe tu <b>nÃºmero de boleto</b>.");
        return;
      }
      if (!last4 || last4.length !== 4) {
        showStatus("warn", "âš ï¸ Escribe los <b>Ãºltimos 4 dÃ­gitos</b> de tu WhatsApp.");
        return;
      }

      $("btnEnter").disabled = true;
      $("btnEnter").innerText = "Validandoâ€¦";

      try {
        const gasUrl = await getGasUrl();
        if (!gasUrl || !gasUrl.includes("/exec")) {
          showStatus("error", "âŒ ConfiguraciÃ³n no disponible. Intenta de nuevo en un momento.");
          return;
        }

        const data = await verifyCamerino(gasUrl, ticket, last4);

        if (!data?.ok) {
          showStatus("error", `âŒ ${data?.error || "No pude verificar esos datos."}`);
          return;
        }

        // Unlock VIP
        $("vipArea").classList.remove("hidden");
        $("vipName").textContent = data.nombre || "Participante";
        $("vipTicket").textContent = `#${data.numero ?? ticket}`;
        $("vipMask").textContent = data.whatsapp_mask ? `(${data.whatsapp_mask})` : "";

        // Audio (solo despuÃ©s de validar)
        const player = $("audioPlayer");
        player.src = AUDIO_URL;

        hideAccessForm();
        setTimeout(() => $("vipArea").scrollIntoView({ behavior: "smooth", block: "start" }), 120);
      } catch (err) {
        showStatus("error", `âŒ ${err?.message || "Error al validar. Intenta de nuevo."}`);
      } finally {
        $("btnEnter").disabled = false;
        $("btnEnter").innerText = "Entrar al Camerino";
      }
    });
  </script>
</body>
</html>



